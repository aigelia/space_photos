# Просто космос: публикуем фотографии NASA и SpaceX в Telegram #

"Просто космос" - это набор скриптов, автоматизирующих публикацию фото в Telegram-каналы, а также скачивание фотографий запусков SpaceX и снимков двух сервисов NASA для последующей публикации. Каждый из скриптов может использоваться независимо от остальных. Как это работает?

## Установка ##

Понадобится установленный Python версии 3.10 или ниже (например, 3.9). Скрипты не гарантированно совместимы с Python 3.11+; также следует установить используемые скриптами библиотеки. Это можно сделать через терминал с помощью команды:

```shell
pip install -r requirements.txt
```

Далее необходимо создать файл `.env` в директории проекта и поместить в него все необходимые данные:
1) `NASA_TOKEN=...`, где будет указан ключ NASA API, который можно получить на [официальном сайте](https://api.nasa.gov) (регистрация не требуется).
2) `TG_TOKEN=...`, где будет указан API-ключ Telegram-бота, который можно получить с помощью [BotFather](https://telegram.me/BotFather), следуя простым инструкциям по созданию бота (потребуется аккаунт в Telegram).
3) `TG_CHAT_ID=...`, где будет указан идентификатор Telegram-канала, в котором вы будете публиковать фото с помощью скрипта. Идентификатор - это по сути то же, что и ваш никнейм, он выглядит вот так: `@example`. 

## Автоматическая публикация фото ##

### `post_on_telegram.py` ###

Скрипт `post_on_telegram.py` позволяет автоматически публиковать фото из любых директорий, находящихся в директории `images`. Вы можете создать директорию с таким именем самостоятельно и добавить в нее любые изображения, либо запустить любой из других скриптов, описанных ниже, для автоматизации скачивания изображений — тогда `images`, если её ещё нет, будет создана автоматически.

Для работы скрипта необходим API-ключ бота, а также идентификатор канала, в который будут осуществляться публикации. **Перед запуском убедитесь в том, что ваш бот добавлен в канал и имеет права администратора.**

Скрипт будет работать до тех пор, пока его не остановят вручную: опубликовав все фото из директории, он будет публиковать их снова в случайном порядке. По умолчанию периодичность публикации — один раз в четыре часа, однако при запуске можно указать конкретную периодичность, используя дополнительный аргумент `--sleeptime`, например, для публикации раз в час:

```bash
python3 post_on_telegram.py --sleeptime 1
```

Также можно указать, откуда брать изображения, с помощью аргумента `--directory`. По умолчанию используется директория `images`.

Пример:

```shell
python3 post_on_telegram.py --directory my_images --sleeptime 3600
```

### `post_random_photo.py` ###

Скрипт `post_random_photo.py` публикует **одно изображение** в Telegram-канал. При запуске вы можете указать конкретный файл через аргумент `--filepath`:

```bash
python3 post_random_photo.py --filepath images/apod/apod_14.jpg
Фото опубликовано: images/apod/apod_14.jpg
```

Если аргумент не указан, будет выбрано случайное изображение из всех файлов, находящихся в директории `images` и её подкаталогах. Также можно указать директорию, из которой будет выбрано случайное фото:

```shell
python3 post_random_photo.py --directory my_images
```

## Скачивание фото космоса через API NASA и SpaceX ##

В директории содержатся еще три скрипта для скачивания фотографий через API, которые также могут быть настроены под потребности конкретного пользователя. Каждый из них создает свой каталог для скачивания изображений в директории images, а при отсутствии images - создает и ее. Во всех трех скриптах вы можете использовать необязательные аргументы `--folder` (позволяет указать директорию для сохранения изображений, по умлочанию это images) и `--count` (регулирует количество загружаемых изображений, по умлочанию - 10 штук):

```shell
python3 fetch_spacex_images.py --folder test --count 100
Фото от SpaceX сохранены!
```

### `fetch_spacex_images.py` ###

Позволяет скачать фото различных запусков космических кораблей SpaceX. API не требует специального ключа. Запустить скрипт можно через терминал, указав при этом в качестве необязательного аргумента `--launch_id` ID запуска, который вас интересует, например:

```shell
python3 fetch_spacex_images.py --launch_id 5eb87d47ffd86e000604b38a
```

Если аргумент не будет указан, либо будет указан неверно, скрипт по умолчанию скачает фотографии, сделанные при последнем запуске SpaceX.

```shell
python3 fetch_spacex_images.py --launch_id 5eb87d47ffd86e000604b38a
Вы указали неверный ID '5eb87d47ffd86e000604b38a'. Скачиваем фото последнего запуска...
Фото от SpaceX сохранены!
```

### `fetch_apod_images.py` ###

Скрипт позволяет автоматически скачивать случайные изображения проекта Astronomy Picture of the Day (APOD) NASA. Это число можно менять, немного отредактировав функцию `get_apod_photos()` - замените параметр значение ключа "count" в словаре с параметрами "params" внутри функции, указав нужное вам количество фото. Для работы скрипта требуется API-ключ NASA.

```shell
python3 fetch_apod_images.py
Фото от NASA APOD сохранены!
```

### `fetch_epic_images.py` ###

Еще один скрипт, работающий с NASA API, а конкретно - с Earth Polychromatic Imaging Camera
(EPIC). По умолчанию скачиваются 10 фото планеты, сделанные за неделю до сегодняшней даты. По желанию можно внести небольшие изменения в первую строку функции `get_epic_photos()`, чтобы получить более "свежие" или более "архивные" фото. Например, если вместо `days=7` указать `days=1`, мы получим вчерашние снимки (при условии, что они есть на сервере). 

```shell
python3 fetch_epic_images.py
Фото от NASA EPIC сохранены!
```

## Вспомогательные модули ##

### `download_utils.py` ###

В директории также хранится модуль `download_utils.py.py`, без которого все три скрипта для скачивания фото через API не будут работать. Он содержит общую функцию для скачивания фото по ссылкам из списков, формируемых основным кодом, а также небольшую функцию для определения расширения файла.

### `publish_utils.py` ####

Этот модуль содержит функции, необходимые для работы кода, публикующего фото через Telegram API; в нем находятся функция, которая собирает пути ко всем изображениям из директории images и её подкаталогов. По умолчанию перемешивает список, но это поведение можно отключить, `передав shuffle_result=False`. Также в модуле находится функция, которая отправляет в Telegram-канал одну фотографию по переданному пути.
